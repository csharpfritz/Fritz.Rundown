@model FollowerGoal
@{
    Layout = null;
}

<!DOCTYPE html>

<html>
<head>
    <title>Followers Goal</title>
    <style>

        .followerBar {
            background: #ccc;
            width: 100%;
            display: flex;
            flex-wrap: nowrap;
            padding: 2px 8px;
        }

        .followerBar span {
            font-family: Arial;
            font-size: 16pt;
            font-weight: 600;
        }

        #progress {
            overflow: hidden;
            position: absolute;
        }

        #fill {
            background-color: #00F;
            color: #FFF;
        }

        .followerBar span {
            flex: 1;
        }

        .current {
            text-align: center;
        }

        .goal {
            text-align: right;
        }

    </style>
</head>
<body>
  <!--16 is the border (8 for each side)-->
  <div id="progress" style="width: @((ViewBag.Width * Model.CurrentValue / Model.GoalValue) + 16)px;">
    <div class="followerBar" id="fill" style="width: @(ViewBag.Width)px">
      <span class="caption">@Model.Caption</span>
      <span class="current">@Model.CurrentValue</span>
      <span class="goal">@Model.GoalValue</span>
    </div>
  </div>
  <div class="followerBar" style="width: @(ViewBag.Width)px">
    <span class="caption">@Model.Caption</span>
    <span class="current">@Model.CurrentValue</span>
    <span class="goal">@Model.GoalValue</span>
  </div>

  <script src="~/lib/jquery/dist/jquery.js"></script>
  <script src="~/js/signalr-client.min.js"></script>
  <script type="text/javascript">
<!--

        $(function () {
          var fullBarWidth = @ViewBag.Width;
          var goalValue = @Model.GoalValue;

          let hubUrl = '@Url.Content("~/followerstream")';
          let httpConnection = new signalR.HttpConnection(hubUrl);
          let hubConnection = new signalR.HubConnection(httpConnection);

          hubConnection.on('OnFollowersCountUpdated', data => {
            //console.log(data);
            document.getElementsByClassName("current")[0].textContent = data;
            document.getElementsByClassName("current")[1].textContent = data;
            //16 is the border (8 for each side)
            document.getElementById("progress").style.width = ((fullBarWidth * parseInt(data, 10) / goalValue) + 16) + "px";
          });

          hubConnection.start();

        });


        /**
        $().ready(function () {

            window.setInterval(function () {

                $.ajax({
                    url: "/api/Followers"
                }).done(function (data) {

                    document.getElementsByClassName("current")[0].textContent = data;
                    document.getElementsByClassName("current")[1].textContent = data;
                    document.getElementById("progress").style.width = (fullBarWidth * parseInt(data,10) / goalValue) + "px";

                })

            }, 5000)

        });
        **/
//-->
  </script>

</body>
</html>
